# Production values for flight-viz
replicaCount:
  backend: 1
  frontend: 1

image:
  backend:
    repository: flight-viz-backend # Override via --set image.backend.repository=$DOCKER_REGISTRY/flight-viz-backend
    tag: latest
    pullPolicy: Always
  frontend:
    repository: flight-viz-frontend # Override via --set image.frontend.repository=$DOCKER_REGISTRY/flight-viz-frontend
    tag: latest
    pullPolicy: Always

# DockerHub private registry settings
# Credentials are provided via --set flags from environment variables
registry:
  enabled: true
  server: "https://index.docker.io/v1/"
  username: "" # Set via --set registry.username=$DOCKER_USERNAME
  password: "" # Set via --set registry.password=$DOCKER_PASSWORD

# PostgreSQL configuration
postgresql:
  enabled: true
  auth:
    username: user
    password: "" # Set via --set postgresql.auth.password=$POSTGRES_PASSWORD
    database: flight_viz_production
  primary:
    persistence:
      enabled: true
      size: 50Gi
      storageClass: "fast-ssd" # 高性能ストレージクラスを指定

# Service configuration
service:
  backend:
    type: ClusterIP
    port: 3000
  frontend:
    type: ClusterIP
    port: 80

# Ingress configuration with SSL
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: example.com # Override via --set ingress.hosts[0].host=$DOMAIN
      paths:
        - path: /api
          pathType: Prefix
          service: backend
        - path: /
          pathType: Prefix
          service: frontend
  tls:
    - secretName: flight-viz-tls
      hosts:
        - example.com # Override via --set ingress.tls[0].hosts[0]=$DOMAIN

# cert-manager configuration
certManager:
  enabled: true
  issuer:
    name: letsencrypt-prod
    server: https://acme-v02.api.letsencrypt.org/directory
    email: "" # Override via --set certManager.issuer.email=$CERT_EMAIL

# Production resource limits
resources:
  backend:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  frontend:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 200m
      memory: 128Mi
  postgresql:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi

# Health checks with longer timeouts for production
healthCheck:
  backend:
    path: /up
    initialDelaySeconds: 60
    periodSeconds: 30
  frontend:
    path: /
    initialDelaySeconds: 30
    periodSeconds: 30

# Environment variables
env:
  rails:
    environment: production

# Default values for flight-viz
replicaCount:
  backend: 1
  frontend: 1

image:
  backend:
    repository: flight-viz-backend
    tag: latest
    pullPolicy: IfNotPresent
  frontend:
    repository: flight-viz-frontend
    tag: latest
    pullPolicy: IfNotPresent

# DockerHub private registry settings
# These values should be overridden via --set flags or environment variables
registry:
  enabled: false
  server: "https://index.docker.io/v1/"
  username: ""
  password: ""

nameOverride: ""
fullnameOverride: ""

# PostgreSQL configuration
postgresql:
  enabled: true
  auth:
    username: user
    password: "" # Should be set via --set or Secret
    database: flight_viz_production
  primary:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: ""

# Service configuration
service:
  backend:
    type: ClusterIP
    port: 3000
  frontend:
    type: ClusterIP
    port: 80
  postgresql:
    type: ClusterIP
    port: 5432

# Ingress configuration
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    # Security headers
    nginx.ingress.kubernetes.io/configuration-snippet: |
      add_header X-Frame-Options "SAMEORIGIN" always;
      add_header X-Content-Type-Options "nosniff" always;
      add_header X-XSS-Protection "1; mode=block" always;
      add_header Referrer-Policy "strict-origin-when-cross-origin" always;
      add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self';" always;
    # cert-manager annotations
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: example.com # Override via --set ingress.hosts[0].host
      paths:
        - path: /api
          pathType: Prefix
          service: backend
        - path: /
          pathType: Prefix
          service: frontend
  tls:
    - secretName: flight-viz-tls
      hosts:
        - example.com # Override via --set ingress.tls[0].hosts[0]

# cert-manager configuration
certManager:
  enabled: true
  issuer:
    name: letsencrypt-prod
    server: https://acme-v02.api.letsencrypt.org/directory
    email: "" # Override via --set certManager.issuer.email

# Resource limits
resources:
  backend:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  frontend:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 100m
      memory: 64Mi
  postgresql:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

# Health checks
healthCheck:
  backend:
    path: /up
    initialDelaySeconds: 30
    periodSeconds: 10
  frontend:
    path: /
    initialDelaySeconds: 10
    periodSeconds: 10

# Environment variables
env:
  rails:
    environment: production
  database:
    host: '{{ include "flight-viz.postgresql.fullname" . }}'

# Security settings
security:
  # Pod Security Context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000

  # Container Security Context
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 1000
    capabilities:
      drop:
        - ALL

  # Network Policies
  networkPolicy:
    enabled: false
    ingress: []
    egress: []

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""
